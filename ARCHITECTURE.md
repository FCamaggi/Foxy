# ğŸ—ï¸ Arquitectura de Foxy Digital

## Diagrama de Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USUARIOS                              â”‚
â”‚  ğŸ‘¤ Jugador 1    ğŸ‘¤ Jugador 2    ğŸ‘¤ Jugador 3 ...           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚              â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    WebSocket (Socket.io)
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ğŸŒ FRONTEND (Cliente)                   â”‚
â”‚         React + Vite + TypeScript                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  App.tsx (Coordinador principal)         â”‚    â”‚
â”‚  â”‚  â”œâ”€ socket.ts (Cliente Socket.io)        â”‚    â”‚
â”‚  â”‚  â”œâ”€ constants.tsx (Config de cartas)     â”‚    â”‚
â”‚  â”‚  â”œâ”€ gameUtils.ts (ValidaciÃ³n local)      â”‚    â”‚
â”‚  â”‚  â””â”€ components/ (UI)                     â”‚    â”‚
â”‚  â”‚     â”œâ”€ CardDisplay.tsx                   â”‚    â”‚
â”‚  â”‚     â”œâ”€ PlayerInput.tsx                   â”‚    â”‚
â”‚  â”‚     â”œâ”€ ScoringTable.tsx                  â”‚    â”‚
â”‚  â”‚     â””â”€ ManualModal.tsx                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â”‚  ğŸ“¡ Eventos Enviados:                             â”‚
â”‚     â€¢ createRoom(config)                          â”‚
â”‚     â€¢ joinRoom(code, name)                        â”‚
â”‚     â€¢ startGame(roomCode)                         â”‚
â”‚     â€¢ submitGuess(guess, bet)                     â”‚
â”‚                                                   â”‚
â”‚  ğŸ“¥ Eventos Recibidos:                            â”‚
â”‚     â€¢ roomCreated(roomCode, playerId)             â”‚
â”‚     â€¢ roomJoined(roomCode, playerId)              â”‚
â”‚     â€¢ gameState(state)                            â”‚
â”‚     â€¢ playerJoined(player)                        â”‚
â”‚     â€¢ gameStarted(state)                          â”‚
â”‚     â€¢ roundCompleted(state)                       â”‚
â”‚     â€¢ gameCompleted(state)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    WebSocket (Socket.io)
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ğŸ”§ BACKEND (Servidor)                    â”‚
â”‚       Node.js + Express + Socket.io               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  server.ts (Servidor principal)          â”‚    â”‚
â”‚  â”‚  â”œâ”€ Manejo de conexiones Socket.io       â”‚    â”‚
â”‚  â”‚  â”œâ”€ Eventos de sala (crear, unir)        â”‚    â”‚
â”‚  â”‚  â”œâ”€ Eventos de juego (iniciar, enviar)   â”‚    â”‚
â”‚  â”‚  â””â”€ Limpieza de salas inactivas          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  gameLogic.ts                            â”‚    â”‚
â”‚  â”‚  â€¢ generateDeck(difficulty)              â”‚    â”‚
â”‚  â”‚  â€¢ DistribuciÃ³n dinÃ¡mica de cartas       â”‚    â”‚
â”‚  â”‚  â€¢ Variabilidad aleatoria                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  models/Room.ts                          â”‚    â”‚
â”‚  â”‚  â€¢ Schema de MongoDB                     â”‚    â”‚
â”‚  â”‚  â€¢ Validaciones                          â”‚    â”‚
â”‚  â”‚  â€¢ MÃ©todo toGameState()                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                   Mongoose ODM
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ’¾ MONGODB ATLAS                          â”‚
â”‚        Base de Datos en la Nube                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Database: foxy                          â”‚    â”‚
â”‚  â”‚  â””â”€ Collection: rooms                    â”‚    â”‚
â”‚  â”‚     â”œâ”€ code: String (Ãºnico)              â”‚    â”‚
â”‚  â”‚     â”œâ”€ hostId: String                    â”‚    â”‚
â”‚  â”‚     â”œâ”€ phase: LOBBY|PLAYING|SCORING      â”‚    â”‚
â”‚  â”‚     â”œâ”€ round: Number                     â”‚    â”‚
â”‚  â”‚     â”œâ”€ deck: [CardData]                  â”‚    â”‚
â”‚  â”‚     â”œâ”€ players: [Player]                 â”‚    â”‚
â”‚  â”‚     â”œâ”€ difficulty: easy|medium|hard      â”‚    â”‚
â”‚  â”‚     â”œâ”€ foxyVariant: standard|...         â”‚    â”‚
â”‚  â”‚     â””â”€ lastActivity: Date                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â”‚  ğŸ”’ Seguridad:                                    â”‚
â”‚     â€¢ AutenticaciÃ³n con usuario/contraseÃ±a        â”‚
â”‚     â€¢ Network Access configurado                  â”‚
â”‚     â€¢ Connection string encriptado                â”‚
â”‚                                                   â”‚
â”‚  ğŸ§¹ Limpieza automÃ¡tica:                          â”‚
â”‚     â€¢ TTL index: 24 horas de inactividad          â”‚
â”‚     â€¢ Cron job: cada 5 minutos                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Flujo de Datos

### 1. Crear Sala

```
Cliente                Servidor               MongoDB
  â”‚                       â”‚                      â”‚
  â”‚â”€createRoom(config)â”€â”€>â”‚                      â”‚
  â”‚                      â”‚â”€save(room)â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€roomDocâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚<â”€roomCreated()â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
  â”‚<â”€gameState()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
  â”‚                      â”‚                      â”‚
```

### 2. Unirse a Sala

```
Cliente 2              Servidor               MongoDB
  â”‚                       â”‚                      â”‚
  â”‚â”€joinRoom(code)â”€â”€â”€â”€â”€>â”‚                      â”‚
  â”‚                      â”‚â”€findOne(code)â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚<â”€â”€roomDocâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                      â”‚â”€update(players)â”€â”€â”€>â”‚
  â”‚<â”€roomJoined()â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
  â”‚                      â”‚                      â”‚
  â”‚                      â”‚â”€â”€playerJoined()â”€â”€â”€> Cliente 1
  â”‚                      â”‚â”€â”€gameState()â”€â”€â”€â”€â”€â”€> Todos
```

### 3. Iniciar Juego

```
Cliente (Host)         Servidor               MongoDB
  â”‚                       â”‚                      â”‚
  â”‚â”€startGame()â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
  â”‚                      â”‚â”€findOne(code)â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚â”€generateDeck()â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                      â”‚â”€update(deck)â”€â”€â”€â”€â”€â”€>â”‚
  â”‚<â”€gameStarted()â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
  â”‚                      â”‚â”€â”€gameStarted()â”€â”€â”€â”€> Todos
  â”‚                      â”‚â”€â”€gameState()â”€â”€â”€â”€â”€â”€> Todos
```

### 4. Enviar Respuesta

```
Cliente                Servidor               MongoDB
  â”‚                       â”‚                      â”‚
  â”‚â”€submitGuess()â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
  â”‚                      â”‚â”€update(guess)â”€â”€â”€â”€â”€>â”‚
  â”‚                      â”‚â”€checkAllSubmitted()â”€â”‚
  â”‚                      â”‚                      â”‚
  â”‚                      â”‚  Si todos enviaron: â”‚
  â”‚                      â”‚â”€incrementRound()â”€â”€>â”‚
  â”‚<â”€roundCompleted()â”€â”€â”€â”€â”‚                      â”‚
  â”‚                      â”‚â”€â”€gameState()â”€â”€â”€â”€â”€â”€> Todos
```

## Despliegue en ProducciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚      â”‚                  â”‚      â”‚                  â”‚
â”‚    NETLIFY       â”‚      â”‚     RENDER       â”‚      â”‚  MONGODB ATLAS   â”‚
â”‚   (Frontend)     â”‚â—„â”€â”€â”€â”€â–¶â”‚    (Backend)     â”‚â—„â”€â”€â”€â”€â–¶â”‚  (Database)      â”‚
â”‚                  â”‚      â”‚                  â”‚      â”‚                  â”‚
â”‚  â€¢ Build auto    â”‚      â”‚  â€¢ Deploy auto   â”‚      â”‚  â€¢ Cluster M0    â”‚
â”‚  â€¢ CDN global    â”‚      â”‚  â€¢ Auto-sleep    â”‚      â”‚  â€¢ 512MB free    â”‚
â”‚  â€¢ SSL gratis    â”‚      â”‚  â€¢ Health checks â”‚      â”‚  â€¢ Backups       â”‚
â”‚                  â”‚      â”‚                  â”‚      â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                         â”‚                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                â”‚
                      â”‚    USUARIOS    â”‚
                      â”‚   ğŸŒ Global    â”‚
                      â”‚                â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Variables de Entorno

### Desarrollo

```
Frontend:
  VITE_SERVER_URL=http://localhost:3001

Backend:
  PORT=3001
  MONGODB_URI=mongodb+srv://...
  CORS_ORIGIN=http://localhost:3000
  NODE_ENV=development
```

### ProducciÃ³n

```
Frontend (Netlify):
  VITE_SERVER_URL=https://foxy-server.onrender.com

Backend (Render):
  PORT=3001
  MONGODB_URI=mongodb+srv://...
  CORS_ORIGIN=https://foxy-game.netlify.app
  NODE_ENV=production
```

## Manejo de Errores

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Errores Manejados                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Sala no encontrada                           â”‚
â”‚  â€¢ Sala llena (mÃ¡x 5 jugadores)                 â”‚
â”‚  â€¢ Partida ya iniciada                          â”‚
â”‚  â€¢ Jugador no es host                           â”‚
â”‚  â€¢ Ya enviaste respuesta                        â”‚
â”‚  â€¢ Solo una apuesta por partida                 â”‚
â”‚  â€¢ DesconexiÃ³n temporal (30s grace period)      â”‚
â”‚  â€¢ MongoDB desconectado                         â”‚
â”‚  â€¢ CORS bloqueado                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Escalabilidad

### Actual (Free Tier)
- âœ… ~50 usuarios simultÃ¡neos
- âœ… ~10 salas activas
- âœ… Miles de partidas almacenadas

### Para Escalar
- ğŸ”¼ MongoDB M2: +almacenamiento, +conexiones
- ğŸ”¼ Render Starter: sin auto-sleep
- ğŸ”¼ Redis: para sesiones en memoria
- ğŸ”¼ Horizontal scaling: mÃºltiples instancias + load balancer

---

**Ãšltima actualizaciÃ³n:** 2026-01-25
